"use strict";(self.webpackChunkiframe_api_docs=self.webpackChunkiframe_api_docs||[]).push([[8860],{33635:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"backend/sign","title":"Request signature","description":"Before sending a response to a request, your service must check the validity of","source":"@site/docs/backend/sign.mdx","sourceDirName":"backend","slug":"/backend/sign","permalink":"/docs/backend/sign","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Request signature","sidebar_position":3},"sidebar":"defaultSidebar","previous":{"title":"Transactions","permalink":"/docs/backend/payments"},"next":{"title":"payment limits","permalink":"/docs/backend/limits"}}');var i=t(74848),r=t(28453);const o={title:"Request signature",sidebar_position:3},d=void 0,a={},c=[{value:"<code>time</code>",id:"time",level:3},{value:"<code>sign</code>",id:"sign",level:3},{value:"Checking the time and signature of the request",id:"checking-the-time-and-signature-of-the-request",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Before sending a response to a request, your service must check the validity of\nthe signature ",(0,i.jsx)(n.code,{children:"sign"})," and the creation time ",(0,i.jsx)(n.code,{children:"time"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"time",children:(0,i.jsx)(n.code,{children:"time"})}),"\n",(0,i.jsxs)(n.p,{children:["Equals the number of seconds since UnixEpoch (January 1 1970 00:00:00 GMT).\nIf the time from the creation of the request to its verification is more than 10\nseconds, the request is considered invalid. The response with ",(0,i.jsx)(n.code,{children:"errorCode: 4"}),"\nmust be returned."]}),"\n",(0,i.jsx)(n.h3,{id:"sign",children:(0,i.jsx)(n.code,{children:"sign"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="signature in pseudocode"',children:'data = {request.body}.toJson().toString() + "SECRET";\nsign = toBase64String(md5(GetBytes(data)));\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Calculated as the MD5 sum of a string that contains JSON-serialized request\nfields (except for the ",(0,i.jsx)(n.code,{children:"sign"})," field) concatenated with the SECRET key. MD5 is\npresented in BASE64 format to save traffic."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SECRET"})," is provided to you when you connect to the IFRAME API."]})}),"\n",(0,i.jsx)(n.h2,{id:"checking-the-time-and-signature-of-the-request",children:"Checking the time and signature of the request"}),"\n",(0,i.jsx)(n.p,{children:"On the side of your service, the following mechanism must be implemented."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'{\n\t"type": "payment",\n\t"token2": "abc",\n\t"betId": 485172195,\n  "betInfo": "[{\\"Coef\\":2.31,\\"CouponType\\":\\"Single\\",\\"DateStart\\":1538609400,\\"Event\\":\\"W1\\",\\"GameName\\":\\"NHL.   Washington Capitals - Boston Bruins   \\",\\"Score\\":\\"0-0\\",\\"SportName\\":\\"Ice Hockey\\"}]",\n\t"summ": "10",\n\t"totalCoef": "2.31"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["On the example of the request signature\n",(0,i.jsx)(n.a,{href:"/backend/API#operation/MakePayment",children:(0,i.jsx)(n.strong,{children:"MakePayment"})}),":"]})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The time since the request was created ",(0,i.jsx)(n.code,{children:"time"})," is checked. If more than 10\nseconds elapsed from the creation of the request to its validation, it must\nbe considered invalid and the response must be returned with ",(0,i.jsx)(n.code,{children:"errorCode: 4"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"time: 1451034874\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The request body is serialized to JSON. Respect the order of the fields:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["int ",(0,i.jsx)(n.code,{children:"time"})]}),"\n",(0,i.jsxs)(n.li,{children:["string ",(0,i.jsx)(n.code,{children:"type"})]}),"\n",(0,i.jsxs)(n.li,{children:["string ",(0,i.jsx)(n.code,{children:"token2"})]}),"\n",(0,i.jsxs)(n.li,{children:["ulong ",(0,i.jsx)(n.code,{children:"betId"})]}),"\n",(0,i.jsxs)(n.li,{children:["string ",(0,i.jsx)(n.code,{children:"betInfo"})]}),"\n",(0,i.jsxs)(n.li,{children:["string ",(0,i.jsx)(n.code,{children:"summ"})]}),"\n",(0,i.jsxs)(n.li,{children:["string ",(0,i.jsx)(n.code,{children:"totalCoef"})]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"sign"})," field is not serialized."]}),"\n",(0,i.jsx)(n.li,{children:"If a field is not received in the request, do not include it in the JSON\nstructure, but follow the specified field order."}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'data = {\n  "time": 1451034874,\n  "type": "payment",\n  "token2": "abc",\n  "betId": 485172195,\n  "betInfo": "[{\\"Coef\\":2.31,\\"CouponType\\":\\"Single\\",\\"DateStart\\":1538609400,\\"Event\\":\\"W1\\",\\"GameName\\":\\"NHL.   Washington Capitals - Boston Bruins   \\",\\"Score\\":\\"0-0\\",\\"SportName\\":\\"Ice Hockey\\"}]",\n  "summ": "10",\n  "totalCoef": "2.31"\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The secret key ",(0,i.jsx)(n.code,{children:"SECRET"})," is added to the resulting string:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'data = \'{"time":1451034874,"type":"payment","token2":"abc","betId":485172195,"betInfo":"[{\\"Coef\\":2.31,\\"CouponType\\":\\"Single\\",\\"DateStart\\":1538609400,\\"Event\\":\\"W1\\",\\"GameName\\":\\"NHL.   Washington Capitals - Boston Bruins   \\",\\"Score\\":\\"0-0\\",\\"SportName\\":\\"Ice Hockey\\"}]","summ":"10","totalCoef":"2.31"}"\' + \'SECRET\';\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"A string is represented as an array of bytes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"databyte = GetBytes(data);\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The MD5 sum of the array is calculated:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"databytemd5 = md5Hash.ComputeHash(databyte);  // hex form: 1d316b9d26a9a2f9989e48072a214f53\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The sum is presented in Base64 format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'sign = Convert.ToBase64String(databytemd5);   // "HTFrnSapovmYnkgHKiFPUw=="\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If the calculated MD5 sum is identical to the request signature, then the\nrequest validity check is passed."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var s=t(96540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);